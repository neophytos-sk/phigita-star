<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0059)http://www.kchodorow.com/blog/2011/06/08/mongo-in-flatland/ -->
<html xmlns="http://www.w3.org/1999/xhtml"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<title>Snail in a Turtleneck  » Blog Archive   » Mongo in Flatland</title>

<meta name="generator" content="WordPress 4.2.3"> <!-- leave this for stats -->

<link rel="stylesheet" href="./Mongo in Flatland_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.kchodorow.com/blog/feed/">
<link rel="alternate" type="text/xml" title="RSS .92" href="http://www.kchodorow.com/blog/feed/rss/">
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://www.kchodorow.com/blog/feed/atom/">
<link rel="pingback" href="http://www.kchodorow.com/blog/xmlrpc.php">

	<link rel="archives" title="July 2015" href="http://www.kchodorow.com/blog/2015/07/">
	<link rel="archives" title="June 2015" href="http://www.kchodorow.com/blog/2015/06/">
	<link rel="archives" title="May 2015" href="http://www.kchodorow.com/blog/2015/05/">
	<link rel="archives" title="April 2015" href="http://www.kchodorow.com/blog/2015/04/">
	<link rel="archives" title="March 2015" href="http://www.kchodorow.com/blog/2015/03/">
	<link rel="archives" title="October 2014" href="http://www.kchodorow.com/blog/2014/10/">
	<link rel="archives" title="September 2014" href="http://www.kchodorow.com/blog/2014/09/">
	<link rel="archives" title="July 2014" href="http://www.kchodorow.com/blog/2014/07/">
	<link rel="archives" title="June 2014" href="http://www.kchodorow.com/blog/2014/06/">
	<link rel="archives" title="May 2014" href="http://www.kchodorow.com/blog/2014/05/">
	<link rel="archives" title="April 2014" href="http://www.kchodorow.com/blog/2014/04/">
	<link rel="archives" title="January 2014" href="http://www.kchodorow.com/blog/2014/01/">
	<link rel="archives" title="December 2013" href="http://www.kchodorow.com/blog/2013/12/">
	<link rel="archives" title="November 2013" href="http://www.kchodorow.com/blog/2013/11/">
	<link rel="archives" title="October 2013" href="http://www.kchodorow.com/blog/2013/10/">
	<link rel="archives" title="September 2013" href="http://www.kchodorow.com/blog/2013/09/">
	<link rel="archives" title="August 2013" href="http://www.kchodorow.com/blog/2013/08/">
	<link rel="archives" title="July 2013" href="http://www.kchodorow.com/blog/2013/07/">
	<link rel="archives" title="June 2013" href="http://www.kchodorow.com/blog/2013/06/">
	<link rel="archives" title="May 2013" href="http://www.kchodorow.com/blog/2013/05/">
	<link rel="archives" title="April 2013" href="http://www.kchodorow.com/blog/2013/04/">
	<link rel="archives" title="March 2013" href="http://www.kchodorow.com/blog/2013/03/">
	<link rel="archives" title="February 2013" href="http://www.kchodorow.com/blog/2013/02/">
	<link rel="archives" title="January 2013" href="http://www.kchodorow.com/blog/2013/01/">
	<link rel="archives" title="December 2012" href="http://www.kchodorow.com/blog/2012/12/">
	<link rel="archives" title="November 2012" href="http://www.kchodorow.com/blog/2012/11/">
	<link rel="archives" title="October 2012" href="http://www.kchodorow.com/blog/2012/10/">
	<link rel="archives" title="September 2012" href="http://www.kchodorow.com/blog/2012/09/">
	<link rel="archives" title="August 2012" href="http://www.kchodorow.com/blog/2012/08/">
	<link rel="archives" title="July 2012" href="http://www.kchodorow.com/blog/2012/07/">
	<link rel="archives" title="June 2012" href="http://www.kchodorow.com/blog/2012/06/">
	<link rel="archives" title="May 2012" href="http://www.kchodorow.com/blog/2012/05/">
	<link rel="archives" title="April 2012" href="http://www.kchodorow.com/blog/2012/04/">
	<link rel="archives" title="March 2012" href="http://www.kchodorow.com/blog/2012/03/">
	<link rel="archives" title="February 2012" href="http://www.kchodorow.com/blog/2012/02/">
	<link rel="archives" title="January 2012" href="http://www.kchodorow.com/blog/2012/01/">
	<link rel="archives" title="December 2011" href="http://www.kchodorow.com/blog/2011/12/">
	<link rel="archives" title="October 2011" href="http://www.kchodorow.com/blog/2011/10/">
	<link rel="archives" title="September 2011" href="http://www.kchodorow.com/blog/2011/09/">
	<link rel="archives" title="August 2011" href="http://www.kchodorow.com/blog/2011/08/">
	<link rel="archives" title="June 2011" href="http://www.kchodorow.com/blog/2011/06/">
	<link rel="archives" title="May 2011" href="http://www.kchodorow.com/blog/2011/05/">
	<link rel="archives" title="April 2011" href="http://www.kchodorow.com/blog/2011/04/">
	<link rel="archives" title="March 2011" href="http://www.kchodorow.com/blog/2011/03/">
	<link rel="archives" title="February 2011" href="http://www.kchodorow.com/blog/2011/02/">
	<link rel="archives" title="January 2011" href="http://www.kchodorow.com/blog/2011/01/">
	<link rel="archives" title="December 2010" href="http://www.kchodorow.com/blog/2010/12/">
	<link rel="archives" title="November 2010" href="http://www.kchodorow.com/blog/2010/11/">
	<link rel="archives" title="October 2010" href="http://www.kchodorow.com/blog/2010/10/">
	<link rel="archives" title="September 2010" href="http://www.kchodorow.com/blog/2010/09/">
	<link rel="archives" title="August 2010" href="http://www.kchodorow.com/blog/2010/08/">
	<link rel="archives" title="July 2010" href="http://www.kchodorow.com/blog/2010/07/">
	<link rel="archives" title="June 2010" href="http://www.kchodorow.com/blog/2010/06/">
	<link rel="archives" title="May 2010" href="http://www.kchodorow.com/blog/2010/05/">
	<link rel="archives" title="April 2010" href="http://www.kchodorow.com/blog/2010/04/">
	<link rel="archives" title="March 2010" href="http://www.kchodorow.com/blog/2010/03/">
	<link rel="archives" title="February 2010" href="http://www.kchodorow.com/blog/2010/02/">
	<link rel="archives" title="January 2010" href="http://www.kchodorow.com/blog/2010/01/">
	<link rel="archives" title="December 2009" href="http://www.kchodorow.com/blog/2009/12/">
	<link rel="archives" title="November 2009" href="http://www.kchodorow.com/blog/2009/11/">
	<link rel="archives" title="October 2009" href="http://www.kchodorow.com/blog/2009/10/">
	<link rel="archives" title="September 2009" href="http://www.kchodorow.com/blog/2009/09/">
	<link rel="archives" title="August 2009" href="http://www.kchodorow.com/blog/2009/08/">
	<link rel="archives" title="July 2009" href="http://www.kchodorow.com/blog/2009/07/">
	<link rel="archives" title="June 2009" href="http://www.kchodorow.com/blog/2009/06/">
	<link rel="archives" title="May 2009" href="http://www.kchodorow.com/blog/2009/05/">
	<link rel="archives" title="April 2009" href="http://www.kchodorow.com/blog/2009/04/">
	<link rel="archives" title="March 2009" href="http://www.kchodorow.com/blog/2009/03/">
	<link rel="archives" title="February 2009" href="http://www.kchodorow.com/blog/2009/02/">

<link rel="canonical" href="./Mongo in Flatland_files/Mongo in Flatland.html">
<link rel="alternate" type="application/rss+xml" title="Snail in a Turtleneck » Mongo in Flatland Comments Feed" href="http://www.kchodorow.com/blog/2011/06/08/mongo-in-flatland/feed/">
		<script async="" src="./Mongo in Flatland_files/async-ads.js"></script><script async="" src="./Mongo in Flatland_files/saved_resource"></script><script type="text/javascript" async="" src="./Mongo in Flatland_files/cse.js"></script><script type="text/javascript" async="" src="./Mongo in Flatland_files/ga.js"></script><script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.kchodorow.com\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.3"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Mongo in Flatland_files/wp-emoji-release.min.js" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="yarppWidgetCss-css" href="./Mongo in Flatland_files/widget.css" type="text/css" media="all">
<link rel="stylesheet" id="fes-css" href="./Mongo in Flatland_files/styles.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-syntax-css-css" href="./Mongo in Flatland_files/wp-syntax.css" type="text/css" media="all">
<script type="text/javascript" src="./Mongo in Flatland_files/jquery.js"></script>
<script type="text/javascript" src="./Mongo in Flatland_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./Mongo in Flatland_files/external-tracking.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.kchodorow.com/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.kchodorow.com/blog/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="NoSQL vs. the world" href="http://www.kchodorow.com/blog/2011/05/05/nosql-vs-the-world/">
<link rel="next" title="PS1++" href="http://www.kchodorow.com/blog/2011/06/27/ps1/">
<meta name="generator" content="WordPress 4.2.3">
<link rel="shortlink" href="http://www.kchodorow.com/blog/?p=1454">
<!-- Google Analytics Tracking by Google Analyticator 6.4.8: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
    var analyticsFileTypes = [''];
    var analyticsSnippet = 'enabled';
    var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
  
	_gaq.push(['_setAccount', 'UA-34508473-1']);
    _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
<script type="text/javascript" async="" src="./Mongo in Flatland_files/embed.js"></script><script async="" type="text/javascript" src="./Mongo in Flatland_files/count.js"></script><script src="./Mongo in Flatland_files/jsapi" type="text/javascript"></script><script type="text/javascript" src="./Mongo in Flatland_files/saved_resource(1)"></script><script type="text/javascript" src="./Mongo in Flatland_files/saved_resource(2)"></script><link type="text/css" href="./Mongo in Flatland_files/default+en.css" rel="stylesheet"><link type="text/css" href="./Mongo in Flatland_files/default.css" rel="stylesheet"><script type="text/javascript" src="./Mongo in Flatland_files/default+en.I.js"></script><script src="./Mongo in Flatland_files/alfie.f51946af45e0b561c60f768335c9eb79.js" async="" charset="UTF-8"></script><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #666666;
background-color: #CECECE;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #E9E9E9;
background-color: #E9E9E9;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #FF9900;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #FF9900;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #0000CC;
}
.gsc-cursor-page {
color: #0000CC;
}
a.gsc-trailing-more-results:link {
color: #0000CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #000000;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #008000;
}
.gs-webResult div.gs-visibleUrl-short {
color: #008000;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #E9E9E9;
background-color: #FFFFFF;
color: #0000CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #FF9900;
background-color: #FFFFFF;
color: #0000CC;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #336699;
background-color: #FFFFFF;
}
.gsc-completion-title {
color: #0000CC;
}
.gsc-completion-snippet {
color: #000000;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #0000CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #0000CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #0000CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #0000CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #000000;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #008000;
}</style><style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-webkit-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gsq_a{padding:0}.gscsep_a{display:none}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em;-webkit-appearance:button}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_a{padding:0 9px}.gsib_a{padding-right:8px;padding-left:8px}.gsst_a{padding-top:3px}.gssb_e{border:0}.gssb_l{margin:5px 0}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style></head>
<body>

<div id="page">

<div id="header">

		<ul>
		<li class="page-item"><a href="http://www.kchodorow.com/">Home</a>
		</li><li class="page_item page-item-261"><a href="http://www.kchodorow.com/blog/about/">About</a></li>
<li class="page_item page-item-2525"><a href="http://www.kchodorow.com/blog/archives/">Archives</a></li>
<li class="page_item page-item-2781"><a href="http://www.kchodorow.com/blog/games/">Games</a></li>
		
		</ul>		

		<h1><a href="http://www.kchodorow.com/blog">Snail in a Turtleneck</a></h1>
</div>

	<div id="content">
				
  	
		<div class="navigation">
			<div class="alignleft">« <a href="http://www.kchodorow.com/blog/2011/05/05/nosql-vs-the-world/" rel="prev">NoSQL vs. the world</a></div>
			<div class="alignright"><a href="http://www.kchodorow.com/blog/2011/06/27/ps1/" rel="next">PS1++</a> »</div>
		</div>
	
		<div class="post" id="post-1454">
			<h2><a href="./Mongo in Flatland_files/Mongo in Flatland.html" rel="bookmark" title="Permanent Link: Mongo in Flatland">Mongo in Flatland</a></h2>
	
			<div class="entrytext">
				<p>MongoDB’s geospatial indexing lets you use a collection as a map.  It works differently than “normal” indexing, but there’s actually a nice, visual way to see what geospatial indexing does.  </p>
<p>Let’s say we have a 16×16 map; something that looks like this:</p>
<p><img src="./Mongo in Flatland_files/map1.png" alt="" title="map1" width="300" height="300" class="aligncenter size-full wp-image-1455"></p>
<p>All of the coordinates in our map (as described above) are somewhere between [0,0] and [16,16], so I’m going to make the <em>min</em> value 0 and the <em>max</em> value 16.</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="javascript" style="font-family:monospace;">db.<span style="color: #660066;">map</span>.<span style="color: #660066;">ensureIndex</span><span style="color: #009900;">(</span><span style="color: #009900;">{</span>point <span style="color: #339933;">:</span> <span style="color: #3366CC;">"2d"</span><span style="color: #009900;">}</span><span style="color: #339933;">,</span> <span style="color: #009900;">{</span>min <span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> max <span style="color: #339933;">:</span> <span style="color: #CC0000;">16</span><span style="color: #339933;">,</span> bits <span style="color: #339933;">:</span> <span style="color: #CC0000;">4</span><span style="color: #009900;">}</span><span style="color: #009900;">)</span></pre></td></tr></tbody></table></div>

<p>This essentially turns our collection into a map.  (Don’t worry about <em>bits</em>, for now, I’ll explain that below.)</p>
<p>Let’s say we have something at the point [4,6].  MongoDB generates a <em>geohash</em> of this point, which describes the point in a way that makes it easier to find things near it (and still be able to distribute the map across multiple servers).  The geohash for this point is a string of bits describing the position of [4,6].  We can find the geohash of this point by dividing our map up into quadrants and determining which quadrant it is in.  So, first we divide the map into 4 parts:</p>
<p><img src="./Mongo in Flatland_files/map2.png" alt="" title="map2" width="300" height="300" class="aligncenter size-full wp-image-1456"></p>
<p>This is the trickiest part: each quadrant can be described by two bits, as shown in the table below:</p>
<table>
<tbody><tr>
<td>01</td>
<td>11</td>
</tr>
<tr>
<td>00</td>
<td>10</td>
</tr>
</tbody></table>
<p>[4,6] is in the lower-left quadrant, which matches 00 in the table above.  Thus, its geohash starts with 00.</p>
<p><b>Geohash so far: 00</b></p>
<p>Now we divide that quadrant again:</p>
<p><img src="./Mongo in Flatland_files/map3.png" alt="" title="map3" width="300" height="300" class="aligncenter size-full wp-image-1457"></p>
<p>[4,6] is now in the upper-right quadrant, so the next two bits in the geohash are 11.  Note that the bottom and left edges are included in the quadrant, the top and right edges are excluded.</p>
<p><b>Geohash so far: 0011</b></p>
<p>Now we divide that quadrant again:</p>
<p><img src="./Mongo in Flatland_files/map4.png" alt="" title="map4" width="300" height="300" class="aligncenter size-full wp-image-1458"></p>
<p>[4,6] is now in the upper-left quadrant, so the next two bits in the geohash are 01.  </p>
<p><b>Geohash so far: 001101</b></p>
<p>Now we divide that quadrant again:</p>
<p><img src="./Mongo in Flatland_files/map5.png" alt="" title="map5" width="300" height="300" class="aligncenter size-full wp-image-1459"></p>
<p>[4,6] is now in the lower-left quadrant, so the next two bits in the geohash are 00.  </p>
<p><b>Geohash so far: 00110100</b></p>
<p>You may wonder: how far do we keep dividing?  That’s exactly what the <em>bits</em> setting is for.  We set it to 4 when we created the index, so we divide into quadrants 4 times.  If we wanted higher precision, we could set <em>bits</em> to something higher.  </p>
<p>You can check your math above by using the <em>geoNear</em> command, which returns the geohash for the point you’re search near:</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> db.<span style="color: #660066;">runCommand</span><span style="color: #009900;">(</span><span style="color: #009900;">{</span>geoNear <span style="color: #339933;">:</span> <span style="color: #3366CC;">"map"</span><span style="color: #339933;">,</span> near <span style="color: #339933;">:</span> <span style="color: #009900;">[</span><span style="color: #CC0000;">4</span><span style="color: #339933;">,</span><span style="color: #CC0000;">6</span><span style="color: #009900;">]</span><span style="color: #009900;">}</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
	<span style="color: #3366CC;">"ns"</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">"test.map"</span><span style="color: #339933;">,</span>
	<span style="color: #3366CC;">"near"</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">"00110100"</span><span style="color: #339933;">,</span>
	<span style="color: #3366CC;">"results"</span> <span style="color: #339933;">:</span> <span style="color: #009900;">[</span> <span style="color: #009900;">]</span><span style="color: #339933;">,</span>
	<span style="color: #3366CC;">"stats"</span> <span style="color: #339933;">:</span> <span style="color: #009900;">{</span>
		<span style="color: #3366CC;">"time"</span> <span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">"btreelocs"</span> <span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">"nscanned"</span> <span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">"objectsLoaded"</span> <span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">"avgDistance"</span> <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">NaN</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">"maxDistance"</span> <span style="color: #339933;">:</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span>
	<span style="color: #009900;">}</span><span style="color: #339933;">,</span>
	<span style="color: #3366CC;">"ok"</span> <span style="color: #339933;">:</span> <span style="color: #CC0000;">1</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>As you can see, the “near” field contains exactly the geohash we’d expect from our calculations.</p>
<p>The interesting thing about geohashing is that this makes it easy to figure out what’s near us, because things are sorted according to their position on the map: every document with a <em>point</em> geohash starting with 00 is in the lower-left quadrant, every point starting with 00111111 is very near the middle, but in the lower-left quadrant.  Thus, you can eyeball where a point is by looking at its geohash.</p>
<p><b>Bits and Precision</b></p>
<p>Let’s say a wizard casts a ring of fire around him with a radius of 2.  Is the point [4,6] caught in that ring of fire?  </p>
<p><img src="./Mongo in Flatland_files/map6.png" alt="" title="map6" width="300" height="300" class="aligncenter size-full wp-image-1460"></p>
<p>It’s pretty obvious from the picture that it isn’t, but if we look at the geohash, we actually can’t tell: [4,6] hashes to 00110100, but so does [4.9, 6.9], and any other value in the square between [4,6] and [5,7].  So, in order to figure out whether the point is within the circle, MongoDB must go to the document and look at the actual value in the <em>point</em> field.  Thus, setting <em>bits</em> to 4 is a bit low for the data we’re using/queries we’re doing.</p>
<p>Generally you shouldn’t bother setting <em>bits</em>, I’ve only set it above for purposes of demonstration.  <em>bits</em> defaults to 26, which gives you approximately 1 foot resolution using latitude and longitude.  The higher the number of bits, the slower geohashing gets (conversely, lower bit values mean faster geohashing, but more accessing documents on lookup).  If you’re doing particularly high or low resolution queries, you might want to play around with different values of <em>bits</em> (in dev, on a representative data set) and see if you get better performance.</p>
<p><em>Thanks to <a href="http://twitter.com/#!/greg10g">Greg Studer</a>, who gave a geospatial tech talk last Friday and inspired this post.  (Every Friday, a 10gen engineer does a tech talk on something they’re working on, which is a really nice way to keep up with all of the cool stuff coworkers are doing.  If you’re ever running an engineering department, I highly recommend them!)</em></p>
<div class="yarpp-related yarpp-related-none">
</div>
	
					
				<p class="postmetadata alt">

						This entry was posted Wednesday, June 8th, 2011 at 7:54 am						and is filed under <a href="http://www.kchodorow.com/blog/category/mongodb/" rel="category tag">MongoDB</a>.
						
													You can skip to the end and leave a response. Pinging is currently not allowed.
			
												
				</p>
	
			</div>
		</div>
		
	
<div id="disqus_thread"><iframe id="dsq-1" data-disqus-uid="1" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Mongo in Flatland_files/saved_resource.html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 799px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>

<script type="text/javascript">
var disqus_url = 'http://www.kchodorow.com/blog/2011/06/08/mongo-in-flatland/';
var disqus_identifier = '1454 http://www.snailinaturtleneck.com/blog/?p=1454';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'snailinaturtleneck';
var disqus_title = "Mongo in Flatland";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=1454';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

	
		
	</div>

	<div id="description">kristina chodorow's blog</div>
	<div id="sidebar">
            <li id="text-4" class="widget widget_text">			<div class="textwidget"><p><a href="http://feeds.feedburner.com/kchodorow"><img src="./Mongo in Flatland_files/RSS_48.png" style="float: left; padding-right: 10px;">Subscribe</a></p>
<p><br></p>
<p><a href="http://www.twitter.com/kchodorow"><img src="./Mongo in Flatland_files/twitter-icon-e1302993368475.png" style="vertical-align: middle; padding-right: 10px;"></a><a href="http://www.twitter.com/kchodorow">Follow me on Twitter</a></p>
</div>
		</li>
<li id="feedburner-email-subscription-2" class="widget feedburner-email-subscription"><h2 class="widgettitle">Email Subscription</h2>
<form class="fes fes-default" action="http://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open( &#39;http://feedburner.google.com/fb/a/mailverify?uri=kchodorow&#39;, &#39;popupwindow&#39;, &#39;scrollbars=yes,width=550,height=520&#39;);return true"><div class="form-group"><label class="sr-only"><span class="screen-reader-text">Email Subscription</span></label><input class="form-control search-field" type="text" value="Your email here" onfocus="if(this.value==&#39;Your email here&#39;)this.value=&#39;&#39;;" onblur="if(this.value==&#39;&#39;)this.value=&#39;Your email here&#39;" name="email"></div><button type="submit" class="btn btn-default btn-submit">Subscribe</button><input type="hidden" value="kchodorow" name="uri"><input type="hidden" name="loc" value="en_US"></form></li>
<li id="text-6" class="widget widget_text"><h2 class="widgettitle">order my books</h2>
			<div class="textwidget"><p><iframe src="./Mongo in Flatland_files/cm(2).html" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe></p>
<p><iframe src="./Mongo in Flatland_files/cm.html" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe></p>
<p><iframe src="./Mongo in Flatland_files/cm(1).html" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe></p>
</div>
		</li>
<li id="text-3" class="widget widget_text"><h2 class="widgettitle">about me</h2>
			<div class="textwidget"><p><a href="http://www.kchodorow.com/blog/about/">I'm a software engineer at Google in NYC.  I have done a lot of work on MongoDB and enjoy reading and cartooning more...</a></p>
</div>
		</li>
<li id="text-9" class="widget widget_text"><h2 class="widgettitle">Search</h2>
			<div class="textwidget"><script>
  (function() {
    var cx = '004478542985472678052:fl59rkbrax8';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div id="___gcse_0"><div class="gsc-control-searchbox-only gsc-control-searchbox-only-en" dir="ltr"><form class="gsc-search-box gsc-search-box-tools" accept-charset="utf-8"><table cellspacing="0" cellpadding="0" class="gsc-search-box"><tbody><tr><td class="gsc-input"><div class="gsc-input-box" id="gsc-iw-id1"><table cellspacing="0" cellpadding="0" id="gs_id50" class="gstl_50 " style="width: 100%; padding: 0px;"><tbody><tr><td id="gs_tti50" class="gsib_a"><input autocomplete="off" type="text" size="10" class="gsc-input" name="search" title="search" id="gsc-i-id1" x-webkit-speech="" x-webkit-grammar="builtin:search" lang="en" dir="ltr" spellcheck="false" style="width: 100%; padding: 0px; border: none; margin: 0px; height: auto; outline: none; background: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif) 0% 50% no-repeat rgb(255, 255, 255);"></td><td class="gsib_b"><div class="gsst_b" id="gs_st50" dir="ltr"><a class="gsst_a" href="javascript:void(0)" style="display: none;"><span class="gscb_a" id="gs_cb50">×</span></a></div></td></tr></tbody></table></div><input type="hidden" name="bgresponse" id="bgresponse"></td><td class="gsc-search-button"><input type="image" src="./Mongo in Flatland_files/search_box_icon.png" class="gsc-search-button gsc-search-button-v2" title="search"></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="clear results">&nbsp;</div></td></tr></tbody></table><table cellspacing="0" cellpadding="0" class="gsc-branding"><tbody><tr><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img"><img src="./Mongo in Flatland_files/small-logo.png" class="gsc-branding-img"></td></tr></tbody></table></form></div></div>
</div>
		</li>
<li id="yarpp_widget-3" class="widget widget_yarpp_widget"><h2 class="widgettitle">Related Posts</h2>
<div class="yarpp-related-widget yarpp-related-none">
<p><em>No related posts.</em></p>
</div>
</li>
	</div>

<hr>
<div id="footer">
	<p>
		Snail in a Turtleneck uses <a href="http://ulfpettersson.se/design/modern/">Modern</a> — designed by <a href="http://ulfpettersson.se/">Ulf Pettersson</a> and powered by
		<a href="http://wordpress.org/">WordPress</a>
		<br><a href="feed:http://www.kchodorow.com/blog/feed/">Entries (RSS)</a>
		and <a href="feed:https://snailinaturtleneck.disqus.com/latest.rss">Comments (RSS)</a>.
	</p>
</div>
</div>

<!-- Wonderful design by Ulf Pettersson - http://ulfpettersson.se/ -->

		        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'snailinaturtleneck';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); 
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
        <link rel="stylesheet" id="yarppRelatedCss-css" href="./Mongo in Flatland_files/related.css" type="text/css" media="all">


<table cellspacing="0" cellpadding="0" class="gstl_50 gssb_c" style="width: 146px; display: none; top: 1507px; position: absolute; left: 1293px;"><tbody><tr><td class="gssb_f"></td><td class="gssb_e" style="width: 100%;"></td></tr></tbody></table></body></html>