<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">
<head>
    <title>PostgreSQL: Documentation: 9.1: WAL Internals</title>
    <style type="text/css" media="screen" title="Normal Text">@import url("/dyncss/docs.css?37466d75");</style>
    <script type="text/javascript" src="/media/js/monospacefix.js?37466d75"></script>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1345454-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
<div id="docHeader">
	<div id="docHeaderLogo">
		<a href="/" title="PostgreSQL"><img src="/media/img/docs/hdr_logo.png" width="206" height="80" alt="PostgreSQL" /></a>
	</div>
</div>

<div id="docContainerWrap">
<div id="docContainer">
<div id="docNavSearchContainer">
<div id="docSearch">
	<form action="/search/" method="get">
	<div>
	<input type="hidden" name="u" value="/docs/9.1/" />
	<label for="q">Search Documentation:&nbsp;</label><input type="text" id="q" name="q" size="20" onfocus="if( this.value==this.defaultValue ) this.value='';" value="Search" /><input id="submit" type="submit" value="Search" />
	</div>
	</form>
</div>
<div id="docNav">
<a href="/" title="Home">Home</a> &rarr; <a href="/docs" title="Documentation">Documentation</a> &rarr; <a href="/docs/manuals" title="Manuals">Manuals</a> &rarr; <a href="/docs/9.1/static/index.html">PostgreSQL 9.1</a>
</div>
<div id="docVersions">
This page in other versions:


	
	
	<a href="/docs/9.0/static/wal-internals.html" title="This page in version 9.0">9.0</a>
	

	/
	
	<b>9.1</b>
	

	/
	
	<a href="/docs/9.2/static/wal-internals.html" title="This page in version 9.2">9.2</a>
	

	/
	
	<a href="/docs/9.3/static/wal-internals.html" title="This page in version 9.3">9.3</a>
	

	/
	
	<a href="/docs/9.4/static/wal-internals.html" title="This page in version 9.4">9.4</a>
	




&nbsp;|&nbsp; Development versions:

	
	
	<a href="/docs/devel/static/wal-internals.html" title="This page in version devel" rel="nofollow">devel</a>
	

	/
	
	<a href="/docs/9.5/static/wal-internals.html" title="This page in version 9.5" rel="nofollow">9.5</a>
	




&nbsp;|&nbsp; Unsupported versions:

	
	
	<a href="/docs/7.4/static/wal-internals.html" title="This page in version 7.4" rel="nofollow">7.4</a>
	

	/
	
	<a href="/docs/8.0/static/wal-internals.html" title="This page in version 8.0" rel="nofollow">8.0</a>
	

	/
	
	<a href="/docs/8.1/static/wal-internals.html" title="This page in version 8.1" rel="nofollow">8.1</a>
	

	/
	
	<a href="/docs/8.2/static/wal-internals.html" title="This page in version 8.2" rel="nofollow">8.2</a>
	

	/
	
	<a href="/docs/8.3/static/wal-internals.html" title="This page in version 8.3" rel="nofollow">8.3</a>
	

	/
	
	<a href="/docs/8.4/static/wal-internals.html" title="This page in version 8.4" rel="nofollow">8.4</a>
	


</div>
</div>

<div id="docContent">
<div class="NAVHEADER">
  <table summary="Header navigation table" width="100%" border="0"
  cellpadding="0" cellspacing="0">
    <tr>
      <th colspan="5" align="center" valign="bottom"><a href=
      "index.html">PostgreSQL 9.1.18 Documentation</a></th>
    </tr>

    <tr>
      <td width="10%" align="left" valign="top"><a title=
      "WAL Configuration" href="wal-configuration.html" accesskey=
      "P">Prev</a></td>

      <td width="10%" align="left" valign="top"><a href="wal.html"
      accesskey="U">Up</a></td>

      <td width="60%" align="center" valign="bottom">Chapter 29.
      Reliability and the Write-Ahead Log</td>

      <td width="20%" align="right" valign="top"><a title=
      "Regression Tests" href="regress.html" accesskey=
      "N">Next</a></td>
    </tr>
  </table>
  <hr class="c1" width="100%" />
</div>

<div class="SECT1">
  <h1 class="SECT1"><a name="WAL-INTERNALS" id=
  "WAL-INTERNALS">29.5. WAL Internals</a></h1>

  <p><acronym class="ACRONYM">WAL</acronym> is automatically
  enabled; no action is required from the administrator except
  ensuring that the disk-space requirements for the <acronym class=
  "ACRONYM">WAL</acronym> logs are met, and that any necessary
  tuning is done (see <a href="wal-configuration.html">Section
  29.4</a>).</p>

  <p><acronym class="ACRONYM">WAL</acronym> logs are stored in the
  directory <tt class="FILENAME">pg_xlog</tt> under the data
  directory, as a set of segment files, normally each 16 MB in size
  (but the size can be changed by altering the <tt class=
  "OPTION">--with-wal-segsize</tt> configure option when building
  the server). Each segment is divided into pages, normally 8 kB
  each (this size can be changed via the <tt class=
  "OPTION">--with-wal-blocksize</tt> configure option). The log
  record headers are described in <tt class=
  "FILENAME">access/xlog.h</tt>; the record content is dependent on
  the type of event that is being logged. Segment files are given
  ever-increasing numbers as names, starting at <tt class=
  "FILENAME">000000010000000000000000</tt>. The numbers do not
  wrap, but it will take a very, very long time to exhaust the
  available stock of numbers.</p>

  <p>It is advantageous if the log is located on a different disk
  from the main database files. This can be achieved by moving the
  <tt class="FILENAME">pg_xlog</tt> directory to another location
  (while the server is shut down, of course) and creating a
  symbolic link from the original location in the main data
  directory to the new location.</p>

  <p>The aim of <acronym class="ACRONYM">WAL</acronym> is to ensure
  that the log is written before database records are altered, but
  this can be subverted by disk drives that falsely report a
  successful write to the kernel, when in fact they have only
  cached the data and not yet stored it on the disk. A power
  failure in such a situation might lead to irrecoverable data
  corruption. Administrators should try to ensure that disks
  holding <span class="PRODUCTNAME">PostgreSQL</span>'s
  <acronym class="ACRONYM">WAL</acronym> log files do not make such
  false reports. (See <a href="wal-reliability.html">Section
  29.1</a>.)</p>

  <p>After a checkpoint has been made and the log flushed, the
  checkpoint's position is saved in the file <tt class=
  "FILENAME">pg_control</tt>. Therefore, at the start of recovery,
  the server first reads <tt class="FILENAME">pg_control</tt> and
  then the checkpoint record; then it performs the REDO operation
  by scanning forward from the log position indicated in the
  checkpoint record. Because the entire content of data pages is
  saved in the log on the first page modification after a
  checkpoint (assuming <a href=
  "runtime-config-wal.html#GUC-FULL-PAGE-WRITES">full_page_writes</a>
  is not disabled), all pages changed since the checkpoint will be
  restored to a consistent state.</p>

  <p>To deal with the case where <tt class=
  "FILENAME">pg_control</tt> is corrupt, we should support the
  possibility of scanning existing log segments in reverse order —
  newest to oldest — in order to find the latest checkpoint. This
  has not been implemented yet. <tt class=
  "FILENAME">pg_control</tt> is small enough (less than one disk
  page) that it is not subject to partial-write problems, and as of
  this writing there have been no reports of database failures due
  solely to the inability to read <tt class=
  "FILENAME">pg_control</tt> itself. So while it is theoretically a
  weak spot, <tt class="FILENAME">pg_control</tt> does not seem to
  be a problem in practice.</p>
</div>

<div class="NAVFOOTER">
  <hr class="c1" width="100%" />

  <table summary="Footer navigation table" width="100%" border="0"
  cellpadding="0" cellspacing="0">
    <tr>
      <td width="33%" align="left" valign="top"><a href=
      "wal-configuration.html" accesskey="P">Prev</a></td>

      <td width="34%" align="center" valign="top"><a href=
      "index.html" accesskey="H">Home</a></td>

      <td width="33%" align="right" valign="top"><a href=
      "regress.html" accesskey="N">Next</a></td>
    </tr>

    <tr>
      <td width="33%" align="left" valign="top"><acronym class=
      "ACRONYM">WAL</acronym> Configuration</td>

      <td width="34%" align="center" valign="top"><a href=
      "wal.html" accesskey="U">Up</a></td>

      <td width="33%" align="right" valign="top">Regression
      Tests</td>
    </tr>
  </table>
</div>

</div>

<div id="docComments">



</div>

<div id="docFooter">
    <a href="/about/privacypolicy">Privacy Policy</a> |
    <a href="/about/">About PostgreSQL</a><br/>
Copyright &copy; 1996-2015 The PostgreSQL Global Development Group
</div>
</div>
</div>
</body>
</html>
